<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ONE - Unirse</title>
    <link rel="stylesheet" href="styles.css" >
</head>
<body class="login-page scan-to-join-page">
    <a class="back-button" href="index.html">
        <svg viewBox="0 0 24 24">
            <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
    </a>
    <div class="floating-card"></div>
    <div class="floating-card"></div>
    <div class="floating-card"></div>
    <div class="floating-card"></div>

    <div class="container">


        <div class="welcome-section">
            <h1 class="welcome-title">¡Unete a una Partida!</h1>
            <!--<p class="welcome-subtitle">Partida mediante codigo</p>-->
        </div>

        <form class="form-container" id="loginForm">
            <div class="input-group">
                <input type="text" id="code" class="input-field" placeholder="Ingresa aqui el Codigo">
            </div>
        </form>
        <button id="joinButton" class="create-match-btn">Unirse</button>
        <span class="orSpan"> o </span>
        <button id="scanToJoinBtn" class="scan-to-join-btn">Escanear para unirse</button>

    </div>
    <script src="updatetoken.js"></script>

    <script>
    const token = localStorage.getItem('jwtToken');

        if (!token) {
            window.location.href = 'login.html';
        }
        else {

            const headers = {
                'Content-Type': 'application/json',
                'Authorization': `Bearer ${token}`
            };

            document.getElementById('joinButton').addEventListener('click', async (e) => {
                // e.preventDefault();

                //const submitButton = e.target.querySelector('button[type="submit"]');
                //const originalText = submitButton.textContent;

                try {
                    //submitButton.textContent = 'Iniciando sesión...';
                    //submitButton.disabled = true;

                    //const formData = {
                    //    Name: document.getElementById('name').value,
                    //    Private: document.getElementById('private').checked,
                    //    NewRules: document.getElementById('newrules').checked
                    //};
                    document.getElementById('code').value
                    const response = await fetch('/api/Sessions/joinByCode/' + document.getElementById('code').value, {
                        method: 'POST',
                        headers

                    });

                    if (response.ok) {
                        //   const token = await response.json;
                        //   sessionStorage.setItem('session', token);
                        window.location.href = 'crearpartida2.html';

                    }
                    //            else {
                    //    const emailInput = document.getElementById('email');
                    //    emailInput.setCustomValidity('Credenciales incorrectas');
                    //    emailInput.reportValidity();
                    //}
                } catch (error) {
                    //const emailInput = document.getElementById('email');
                    //emailInput.setCustomValidity('Error de conexión');
                    //emailInput.reportValidity();
                } finally {
                    //submitButton.textContent = originalText;
                    //submitButton.disabled = false;
                }
            });

            // Quitar mensaje validación al escribir
            //document.getElementById('email').addEventListener('input', function () {
            //    this.setCustomValidity('');
            //});
            //document.getElementById('password').addEventListener('input', function () {
            //    document.getElementById('email').setCustomValidity('');
            //});
        }

    </script>

    <!--<script src="script.js"></script>-->


</body>
</html>
